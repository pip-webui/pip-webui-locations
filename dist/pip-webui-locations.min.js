!function(o){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=o();else if("function"==typeof define&&define.amd)define([],o);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,(t.pip||(t.pip={})).locations=o()}}(function(){return function o(t,i,n){function e(p,l){if(!i[p]){if(!t[p]){var s="function"==typeof require&&require;if(!l&&s)return s(p,!0);if(a)return a(p,!0);var c=new Error("Cannot find module '"+p+"'");throw c.code="MODULE_NOT_FOUND",c}var r=i[p]={exports:{}};t[p][0].call(r.exports,function(o){var i=t[p][1][o];return e(i||o)},r,r.exports,o,t,i,n)}return i[p].exports}for(var a="function"==typeof require&&require,p=0;p<n.length;p++)e(n[p]);return e}({1:[function(o,t,i){function n(o){var t=o.has("pipTranslate")?o.get("pipTranslate"):null;return function(o){return t?t.translate(o)||o:o}}n.$inject=["$injector"],angular.module("pipLocations.Translate",[]).filter("translate",n)},{}],2:[function(o,t,i){angular.module("pipLocations",["pipLocation","pipLocationMap","pipLocationIp","pipLocationEditDialog","pipLocationEdit","pipLocations.Translate"])},{}],3:[function(o,t,i){var n={pipLocationName:"<",pipLocationPos:"<",pipShowLocationIcon:"<",pipCollapse:"<",pipRebind:"<",pipDisabled:"<",pipLocationResize:"&"},e=(function(){function o(){}}(),function(){function o(o,t,i){"ngInject";this.$element=o,this.$timeout=t,this.$scope=i,this.showMap=!0,o.addClass("pip-location")}return o.$inject=["$element","$timeout","$scope"],o.prototype.$postLink=function(){var o=this;this.$timeout(function(){o.name=o.$element.find(".pip-location-name"),o.mapContainer=o.$element.find(".pip-location-container"),!0===o.pipCollapse&&(o.mapContainer.hide(),o.showMap=!1,o.name.click(function(t){t.stopPropagation(),o.pipDisabled||(o.showMap=!o.showMap,o.mapContainer[o.showMap?"show":"hide"](),o.showMap&&o.generateMap(),o.$scope.$$phase||o.$scope.$apply())})),o.redrawMap()})},o.prototype.redrawMap=function(){this.mapContainer&&(this.pipLocationPos&&!0===this.showMap?this.generateMap():this.clearMap())},o.prototype.$onChanges=function(o){this.pipRebind=!!o.pipRebind&&(o.pipRebind.currentValue||!1),this.pipShowLocationIcon=!!o.pipShowLocationIcon&&(o.pipShowLocationIcon.currentValue||!1),this.pipCollapse=!!o.pipCollapse&&(o.pipCollapse.currentValue||!1),this.pipDisabled=!!o.pipDisabled&&(o.pipDisabled.currentValue||!1),this.pipRebind&&(this.pipLocationName=o.pipLocationName?o.pipLocationName.currentValue:null,this.pipLocationPos=o.pipLocationPos?o.pipLocationPos.currentValue:null,this.redrawMap())},o.prototype.clearMap=function(){this.mapControl&&this.mapControl.remove(),this.mapControl=null,this.mapContainer.hide()},o.prototype.generateMap=function(){var o=this.pipLocationPos;if(!1===this.showMap||null==o||null==o.coordinates||o.coordinates.length<0)return void this.clearMap();var t=new google.maps.LatLng(o.coordinates[0],o.coordinates[1]);this.mapControl&&this.mapControl.remove(),this.mapControl=$("<div></div>"),this.mapContainer.show(),this.mapControl.appendTo(this.mapContainer);var i={center:t,zoom:12,mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:!0,disableDoubleClickZoom:!0,scrollwheel:!1,draggable:!1},n=new google.maps.Map(this.mapControl[0],i);new google.maps.Marker({position:t,map:n})},o}()),a={bindings:n,templateUrl:"location/Location.html",controller:e};angular.module("pipLocation",[]).component("pipLocation",a)},{}],4:[function(o,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0})},{}],5:[function(o,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function o(o,t,i,n,e,a){var p=this;this.$scope=o,this.$mdDialog=n,this._map=null,this._marker=null,this.onSetLocation=function(){var o=this;null!==this._map&&navigator.geolocation.getCurrentPosition(function(t){var i=new google.maps.LatLng(t.coords.latitude,t.coords.longitude);o._marker=o.createMarker(i),o._map.setCenter(i),o._map.setZoom(12),o.changeLocation(i,null)},function(){o.$scope.$apply()},{maximumAge:0,enableHighAccuracy:!0,timeout:5e3})},this.theme=t.$theme,this.locationPos=e&&"Point"==e.type&&e.coordinates&&2==e.coordinates.length?e:null,this.locationName=a,this.supportSet=null!=navigator.geolocation,i(function(){var o=$(".pip-location-edit-dialog .pip-location-container"),t=p.locationPos?new google.maps.LatLng(p.locationPos.coordinates[0],p.locationPos.coordinates[1]):null,n={center:new google.maps.LatLng(0,0),zoom:1,mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:!0};null!=t&&(n.center=t,n.zoom=12),p._map=new google.maps.Map(o[0],n),p._marker=p.createMarker(t),i(function(){google.maps.event.trigger(p._map,"resize")},1e3)},0),o.$on("pipLayoutResized",function(){null!=p._map&&google.maps.event.trigger(p._map,"resize")})}return o.prototype.createMarker=function(o){var t=this;if(this._marker&&this._marker.setMap(null),o){this._marker=new google.maps.Marker({position:o,map:this._map,draggable:!0,animation:google.maps.Animation.DROP});var i=this._marker;google.maps.event.addListener(i,"dragend",function(){var o=i.getPosition();t.changeLocation(o,null)})}else this._marker=null;return this._marker},o.prototype.changeLocation=function(o,t){var i=this;this.locationPos={type:"Point",coordinates:[o.lat(),o.lng()]},this.locationName=null,(new google.maps.Geocoder).geocode({latLng:o},function(o,t){o&&o.length>0&&(i.locationName=o[0].formatted_address),i.$scope.$apply()})},o.prototype.onAddPin=function(){if(null!==this._map){var o=this._map.getCenter();this._marker=this.createMarker(o),this.changeLocation(o,null)}},o.prototype.onRemovePin=function(){null!==this._map&&(this._marker=this.createMarker(null),this.locationPos=null,this.locationName=null)},o.prototype.onZoomIn=function(){if(null!==this._map){var o=this._map.getZoom();this._map.setZoom(o+1)}},o.prototype.onZoomOut=function(){if(null!==this._map){var o=this._map.getZoom();this._map.setZoom(o>1?o-1:o)}},o.prototype.onCancel=function(){this.$mdDialog.cancel()},o.prototype.onApply=function(){this.$mdDialog.hide({location:this.locationPos,locationPos:this.locationPos,locationName:this.locationName})},o}(),e=function(){function o(o){this.$mdDialog=o}return o.$inject=["$mdDialog"],o.prototype.show=function(o,t,i){this.$mdDialog.show({controller:n,controllerAs:"$ctrl",templateUrl:"location_dialog/LocationDialog.html",locals:{locationName:o.locationName,locationPos:o.locationPos},clickOutsideToClose:!0}).then(function(o){t&&t(o)},function(){i&&i()})},o}(),a=function(o){var t=o.has("pipTranslate")?o.get("pipTranslate"):null;t&&(t.setTranslations("en",{LOCATION_ADD_LOCATION:"Add location",LOCATION_SET_LOCATION:"Set location",LOCATION_ADD_PIN:"Add pin",LOCATION_REMOVE_PIN:"Remove pin"}),t.setTranslations("ru",{LOCATION_ADD_LOCATION:"Добавить местоположение",LOCATION_SET_LOCATION:"Определить положение",LOCATION_ADD_PIN:"Добавить точку",LOCATION_REMOVE_PIN:"Убрать точку"}))};a.$inject=["$injector"],angular.module("pipLocationEditDialog").run(a).service("pipLocationEditDialog",e)},{}],6:[function(o,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function o(){}return o}();i.LocationDialogParams=n},{}],7:[function(o,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),angular.module("pipLocationEditDialog",["ngMaterial","pipLocations.Templates"]),o("./LocationDialog")},{"./LocationDialog":5}],8:[function(o,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n={pipLocationName:"=",pipLocationPos:"=",pipLocationHolder:"=",ngDisabled:"<",pipChanged:"&"},e=(function(){function o(){}}(),function(){function o(o,t,i){var n=this;this.$element=o,this.$scope=t,this.pipLocationEditDialog=i,this.defineCoordinatesDebounced=_.debounce(function(){n.defineCoordinates},2e3)}return o.prototype.$postLink=function(){var o=this;this.$element.find("md-input-container").attr("md-no-float",(!!this.pipLocationHolder).toString()),this.empty=this.$element.children(".pip-location-empty"),this.mapContainer=this.$element.children(".pip-location-container"),this.mapControl=null,this.$scope.$watch("$ctrl.pipLocationName",function(t,i){t!==i&&o.defineCoordinatesDebounced()}),this.$scope.$watch("$ctrl.pipLocationPos",function(){o.generateMap()}),this.$element.addClass("pip-location-edit"),this.pipLocationPos?this.generateMap():this.clearMap()},o.prototype.$onChanges=function(o){this.ngDisabled=!!o.ngDisabled&&o.ngDisabled.currentValue},o.prototype.clearMap=function(){this.mapControl&&this.mapControl.remove(),this.mapControl=null,this.mapContainer.hide(),this.empty.show()},o.prototype.generateMap=function(){var o=this.pipLocationPos;if(null==o||null==o.coordinates||o.coordinates.length<0)return void this.clearMap();var t=new google.maps.LatLng(o.coordinates[0],o.coordinates[1]);this.mapControl&&this.mapControl.remove(),this.mapContainer.show(),this.empty.hide(),this.mapControl=$("<div></div>"),this.mapControl.appendTo(this.mapContainer);var i={center:t,zoom:12,mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:!0,disableDoubleClickZoom:!0,scrollwheel:!1,draggable:!1},n=new google.maps.Map(this.mapControl[0],i);new google.maps.Marker({position:t,map:n})},o.prototype.defineCoordinates=function(){var o=this.pipLocationName;if(""==o)return this.pipLocationPos=null,this.clearMap(),void this.$scope.$apply();(new google.maps.Geocoder).geocode({address:o},function(o,t){this.$scope.$apply(function(){if(t===google.maps.GeocoderStatus.OK){if(null===o||0===o.length)return this.pipLocationPos=null,void this.clearMap();var i=o[0].geometry||{},n=i.location||{};if(null===n.lat||null===n.lng)return this.pipLocationPos=null,void this.clearMap();this.pipLocationPos={type:"Point",coordinates:{latitude:n.lat(),longtitude:n.lng()}},this.generateMap()}else this.pipLocationPos=null,this.clearMap()})})},o.prototype.onSetLocation=function(){var o=this;this.ngDisabled||this.pipLocationEditDialog.show({locationName:this.pipLocationName,locationPos:this.pipLocationPos},function(t){var i=t.location,n=t.locationName;o.pipLocationPos&&"Point"==o.pipLocationPos.type&&2==o.pipLocationPos.coordinates.length&&i&&2==i.coordinates.length&&o.pipLocationPos.coordinates[0]-i.coordinates[0]<1e-4&&o.pipLocationPos.coordinates[1]-i.coordinates[1]<1e-4&&n===o.pipLocationName||(o.pipLocationPos=i,o.pipLocationName=n,null===n&&null!==i&&(o.pipLocationName="("+t.location.coordinates[0]+","+t.location.coordinates[1]+")"),o.pipChanged(),o.mapContainer[0].focus())})},o.prototype.onMapClick=function(o){this.ngDisabled||(this.mapContainer[0].focus(),this.onSetLocation())},o.prototype.onMapKeyPress=function(o){this.ngDisabled||13!=o.keyCode&&32!=o.keyCode||this.onSetLocation()},o}()),a={bindings:n,templateUrl:"location_edit/LocationEdit.html",controller:e};angular.module("pipLocationEdit",["pipLocationEditDialog"]).component("pipLocationEdit",a)},{}],9:[function(o,t,i){var n={pipIpaddress:"<",pipExtraInfo:"&",pipRebind:"<"},e=(function(){function o(){}}(),function(){function o(o,t){this.$http=t,this.mapContainer=o.children(".pip-location-container"),o.addClass("pip-location-ip"),this.defineCoordinates()}return o.prototype.$onChanges=function(o){this.pipRebind=!!o.pipRebind&&(o.pipRebind.currentValue||!1),!0===this.pipRebind&&(this.pipIpaddress=o.pipIpaddress?o.pipIpaddress.currentValue:this.pipIpaddress,this.defineCoordinates())},o.prototype.clearMap=function(){this.mapControl&&this.mapControl.remove(),this.mapControl=null},o.prototype.generateMap=function(o,t){if(null==o||null==t)return void this.clearMap();var i=new google.maps.LatLng(o,t);this.mapControl&&this.mapControl.remove(),this.mapControl=$("<div></div>"),this.mapControl.appendTo(this.mapContainer);var n={center:i,zoom:12,mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:!0,disableDoubleClickZoom:!0,scrollwheel:!1,draggable:!1},e=new google.maps.Map(this.mapControl[0],n);new google.maps.Marker({position:i,map:e})},o.prototype.defineCoordinates=function(){var o=this,t=this.pipIpaddress;if(""==t)return void this.clearMap();this.$http.get("https://freegeoip.net/json/"+t).success(function(t){if(null!=t&&null!=t.latitude&&null!=t.longitude){if(o.generateMap(t.latitude,t.longitude),o.pipExtraInfo){var i={city:t.city,regionCode:t.regionCode,region:t.regionName,zipCode:t.zipCode,countryCode:t.countryCode,country:t.countryName};o.pipExtraInfo({extraInfo:i})}}else o.clearMap()}).error(function(t){o.clearMap()})},o}()),a={bindings:n,template:'<div class="pip-location-container"></div>',controller:e};angular.module("pipLocationIp",[]).component("pipLocationIp",a)},{}],10:[function(o,t,i){var n={pipLocationPos:"<",pipIconPath:"<",pipInteractive:"<",pipStretch:"<",pipRebind:"<"},e=(function(){function o(){}}(),function(){function o(o){this.$element=o,this.mapControl=null,this.mapContainer=o.children(".pip-location-container"),o.addClass("pip-location-map")}return o.prototype.$onChanges=function(o){this.pipRebind=!!o.pipRebind&&(o.pipRebind.currentValue||!1),this.pipInteractive=!!o.pipInteractive&&(o.pipInteractive.currentValue||!1),this.pipStretch=!!o.pipStretch&&(o.pipStretch.currentValue||!1),!0===this.pipStretch?this.mapContainer.addClass("stretch"):this.mapContainer.removeClass("stretch"),!0===this.pipRebind&&(this.pipLocationPos=o.pipLocationPos?o.pipLocationPos.currentValue:this.pipLocationPos,this.pipIconPath=o.pipIconPath?o.pipIconPath.currentValue:this.pipIconPath,this.generateMap())},o.prototype.clearMap=function(){this.mapControl&&this.mapControl.remove(),this.mapControl=null},o.prototype.checkLocation=function(o){return!(null==o||null==o.coordinates||o.coordinates.length<0)},o.prototype.determineCoordinates=function(o){var t=new google.maps.LatLng(o.coordinates[0],o.coordinates[1]);return t.fill=o.fill,t.stroke=o.stroke,t},o.prototype.generateMap=function(){var o=this,t=this.pipLocationPos,i=[],n=this.pipInteractive||!1;if(this.checkLocation(t)&&!_.isArray(t)?i.push(this.determineCoordinates(t)):t&&_.isArray(t)&&t.length>0&&_.each(t,function(t){o.checkLocation(t)&&i.push(o.determineCoordinates(t))}),0===i.length)return void this.clearMap();this.mapControl&&this.mapControl.remove(),this.mapControl=$("<div></div>"),this.mapControl.appendTo(this.mapContainer);var e={center:i[0],zoom:12,mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:!0,disableDoubleClickZoom:!0,scrollwheel:n,draggable:n},a=new google.maps.Map(this.mapControl[0],e),p=new google.maps.LatLngBounds;_.each(i,function(t){var i={path:o.pipIconPath,fillColor:t.fill||"#EF5350",fillOpacity:1,scale:1,strokeColor:t.stroke||"white",strokeWeight:5};new google.maps.Marker({position:t,map:a,icon:o.pipIconPath?i:null}),p.extend(t)}),i.length>1&&a.fitBounds(p)},o}()),a={bindings:n,template:'<div class="pip-location-container"></div>',controller:e};angular.module("pipLocationMap",[]).component("pipLocationMap",a)},{}],11:[function(o,t,i){!function(o){try{o=angular.module("pipLocations.Templates")}catch(t){o=angular.module("pipLocations.Templates",[])}o.run(["$templateCache",function(o){o.put("location/Location.html",'<div class="pip-location-name location-collapse" ng-click="$ctrl.pipLocationResize()" ng-if="!$ctrl.pipCollapse" ng-class="$ctrl.pipShowLocationIcon ? \'pip-location-icon-space\' : \'\'"><md-icon md-svg-icon="icons:location" class="flex-fixed pip-icon" ng-if="$ctrl.pipShowLocationIcon"></md-icon><span class="pip-location-text">{{$ctrl.pipLocationName}}</span></div><md-button class="pip-location-name" ng-click="$ctrl.pipLocationResize()" ng-if="$ctrl.pipCollapse" ng-class="$ctrl.pipShowLocationIcon ? \'pip-location-icon-space\' : \'\'"><div class="layout-align-start-center layout-row w-stretch"><md-icon md-svg-icon="icons:location" class="flex-fixed pip-icon" ng-if="$ctrl.pipShowLocationIcon"></md-icon><span class="pip-location-text flex">{{$ctrl.pipLocationName}}</span><md-icon md-svg-icon="icons:triangle-down" class="flex-fixed" ng-show="!$ctrl.showMap"></md-icon><md-icon md-svg-icon="icons:triangle-up" class="flex-fixed" ng-show="$ctrl.showMap"></md-icon></div></md-button><div class="pip-location-container"></div>')}])}(),function(o){try{o=angular.module("pipLocations.Templates")}catch(t){o=angular.module("pipLocations.Templates",[])}o.run(["$templateCache",function(o){o.put("location_edit/LocationEdit.html",'<md-input-container class="md-block"><label>{{ \'LOCATION\' | translate }}</label> <input ng-model="$ctrl.pipLocationName" ng-disabled="$ctrl.ngDisabled"></md-input-container><div class="pip-location-empty" layout="column" layout-align="center center"><md-button class="md-raised" ng-disabled="$ctrl.ngDisabled" ng-click="$ctrl.onSetLocation()" aria-label="LOCATION_ADD_LOCATION"><span class="icon-location"></span> {{\'LOCATION_ADD_LOCATION\' | translate }}</md-button></div><div class="pip-location-container" tabindex="{{ $ctrl.ngDisabled ? -1 : 0 }}" ng-click="$ctrl.onMapClick($event)" ng-keypress="$ctrl.onMapKeyPress($event)"></div>')}])}(),function(o){try{o=angular.module("pipLocations.Templates")}catch(t){o=angular.module("pipLocations.Templates",[])}o.run(["$templateCache",function(o){o.put("location_dialog/LocationDialog.html",'<md-dialog class="pip-dialog pip-location-edit-dialog layout-column" md-theme="{{$ctrl.theme}}"><div class="pip-header layout-column layout-align-start-start"><md-progress-linear ng-show="$ctrl.transaction.busy()" md-mode="indeterminate" class="pip-progress-top"></md-progress-linear><h3 class="flex">{{ \'LOCATION_SET_LOCATION\' | translate }}</h3></div><div class="pip-footer"><div class="layout-row layout-align-start-center"><md-button class="md-accent" ng-click="$ctrl.onAddPin()" ng-show="$ctrl.locationPos == null" ng-disabled="$ctrl.transaction.busy()" aria-label="{{ ::\'LOCATION_ADD_PIN\' }}">{{ ::\'LOCATION_ADD_PIN\' | translate }}</md-button><md-button class="md-accent" ng-click="$ctrl.onRemovePin()" ng-show="$ctrl.locationPos != null" ng-disabled="$ctrl.transaction.busy()" aria-label="{{ ::\'LOCATION_REMOVE_PIN\' }}">{{ ::\'LOCATION_REMOVE_PIN\' | translate }}</md-button></div><div class="flex"></div><div class="layout-row layout-align-end-center"><md-button ng-click="$ctrl.onCancel()" aria-label="{{ ::\'CANCEL\' }}">{{ ::\'CANCEL\' | translate }}</md-button><md-button class="md-accent" ng-click="$ctrl.onApply()" ng-disabled="$ctrl.transaction.busy()" aria-label="{{ ::\'APPLY\' }}">{{ ::\'APPLY\' | translate }}</md-button></div></div><div class="pip-body"><div class="pip-location-container"></div><md-button class="md-icon-button md-fab pip-zoom-in" ng-click="$ctrl.onZoomIn()" aria-label="{{ ::\'LOCATION_ZOOM_IN\' }}"><md-icon md-svg-icon="icons:plus"></md-icon></md-button><md-button class="md-icon-button md-fab pip-zoom-out" ng-click="$ctrl.onZoomOut()" aria-label="{{ ::\'LOCATION_ZOOM_OUT\' }}"><md-icon md-svg-icon="icons:minus"></md-icon></md-button><md-button class="md-icon-button md-fab pip-set-location" ng-click="$ctrl.onSetLocation()" aria-label="{{ ::\'LOCATION_SET_LOCATION\' }}" ng-show="supportSet" ng-disabled="transaction.busy()"><md-icon md-svg-icon="icons:target"></md-icon></md-button></div></md-dialog>')}])}()},{}]},{},[11,1,2,4,7,5,6,8,9,10,3])(11)});
//# sourceMappingURL=pip-webui-locations.min.js.map
