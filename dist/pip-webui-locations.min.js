!function(o){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=o();else if("function"==typeof define&&define.amd)define([],o);else{var n;n="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,(n.pip||(n.pip={})).locations=o()}}(function(){return function o(n,i,t){function e(l,c){if(!i[l]){if(!n[l]){var p="function"==typeof require&&require;if(!c&&p)return p(l,!0);if(a)return a(l,!0);var r=new Error("Cannot find module '"+l+"'");throw r.code="MODULE_NOT_FOUND",r}var s=i[l]={exports:{}};n[l][0].call(s.exports,function(o){var i=n[l][1][o];return e(i?i:o)},s,s.exports,o,n,i,t)}return i[l].exports}for(var a="function"==typeof require&&require,l=0;l<t.length;l++)e(t[l]);return e}({1:[function(o,n,i){!function(){"use strict";var o=angular.module("pipLocations.Translate",[]);o.filter("translate",["$injector",function(o){var n=o.has("pipTranslate")?o.get("pipTranslate"):null;return function(o){return n?n.translate(o)||o:o}}])}()},{}],2:[function(o,n,i){!function(){"use strict";var o=angular.module("pipLocation",[]);o.directive("pipLocation",function(){return{restrict:"EA",scope:{pipLocationName:"&",pipLocationPos:"&",pipLocationResize:"&",pipShowLocationIcon:"="},template:function(o,n){function i(o){return null!=o&&(!!o&&(o=o.toString().toLowerCase(),"1"==o||"true"==o))}return i(n.pipCollapse)?String()+'<div class="pip-location-name location-collapse" ng-click="pipLocationResize()" ng-hide="!pipLocationName()"ng-class="pipShowLocationIcon ? \'pip-location-icon-space\' : \'\'"><md-icon md-svg-icon="icons:location" class="flex-fixed pip-icon" ng-if="pipShowLocationIcon"></md-icon><span class="pip-location-text">{{pipLocationName()}}</span> </div><div class="pip-location-container" ng-hide="!pipLocationPos()"></div>':String()+'<md-button class="pip-location-name" ng-click="pipLocationResize()" ng-class="pipShowLocationIcon ? \'pip-location-icon-space\' : \'\'"><div class="layout-align-start-center layout-row w-stretch"><md-icon md-svg-icon="icons:location" class="flex-fixed pip-icon" ng-if="pipShowLocationIcon"></md-icon><span class="pip-location-text flex">{{pipLocationName()}}</span><md-icon md-svg-icon="icons:triangle-down" class="flex-fixed" ng-if="!showMap"></md-icon><md-icon md-svg-icon="icons:triangle-up" class="flex-fixed" ng-if="showMap"></md-icon></div></md-button><div class="pip-location-container"ng-class="pipShowLocationIcon ? \'pip-location-icon-space\' : \'\'"></div>'},controller:"pipLocationController"}}),o.controller("pipLocationController",["$scope","$element","$attrs",function(o,n,i){function t(o){return null!=o&&(!!o&&(o=o.toString().toLowerCase(),"1"==o||"true"==o))}function e(){p&&p.remove(),p=null,c.hide()}function a(){var n=o.pipLocationPos();if(0==o.showMap||null==n||null==n.coordinates||n.coordinates.length<0)return void e();var i=new google.maps.LatLng(n.coordinates[0],n.coordinates[1]);p&&p.remove(),p=$("<div></div>"),c.show(),p.appendTo(c);var t={center:i,zoom:12,mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:!0,disableDoubleClickZoom:!0,scrollwheel:!1,draggable:!1},a=new google.maps.Map(p[0],t);new google.maps.Marker({position:i,map:a})}var l=n.children(".pip-location-name"),c=n.children(".pip-location-container"),p=null,r=n.find(".icon-up"),s=n.find(".icon-down"),d=t(i.pipCollapse);d||(o.showMap=!1,r.hide(),c.hide(),l.click(function(n){n.stopPropagation(),i.disabled||(o.showMap=!o.showMap,r[o.showMap?"show":"hide"](),s[o.showMap?"hide":"show"](),a())})),t(i.pipRebind)&&o.$watch(o.pipLocationPos,function(o){a()}),n.addClass("pip-location"),o.pipLocationPos()?a():e()}])}()},{}],3:[function(o,n,i){var t=function(){function o(o){this._$mdDialog=o}return o.$inject=["$mdDialog"],o.prototype.show=function(o,n,i){this._$mdDialog.show({controller:"pipLocationEditDialogController",controllerAs:"$ctrl",templateUrl:"location_dialog/location_dialog.html",locals:{locationName:o.locationName,locationPos:o.locationPos},clickOutsideToClose:!0}).then(function(o){n&&n(o)},function(){i&&i()})},o}(),e=function(){function o(o,n,i,t,e,a){var l=this;this._map=null,this._marker=null,this.onSetLocation=function(){var o=this;null!=this._map&&navigator.geolocation.getCurrentPosition(function(n){var i=new google.maps.LatLng(n.coords.latitude,n.coords.longitude);o._marker=o.createMarker(i),o._map.setCenter(i),o._map.setZoom(12),o.changeLocation(i,null)},function(){o.$scope.$apply()},{maximumAge:0,enableHighAccuracy:!0,timeout:5e3})},this._$mdDialog=t,this._$scope=o,this.theme=n.$theme,this.locationPos=e&&"Point"==e.type&&e.coordinates&&2==e.coordinates.length?e:null,this.locationName=a,this.supportSet=null!=navigator.geolocation,i(function(){var o=$(".pip-location-edit-dialog .pip-location-container"),n=l.locationPos?new google.maps.LatLng(l.locationPos.coordinates[0],l.locationPos.coordinates[1]):null,i={center:new google.maps.LatLng(0,0),zoom:1,mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:!0};null!=n&&(i.center=n,i.zoom=12),l._map=new google.maps.Map(o[0],i),l._marker=l.createMarker(n),setTimeout(function(){google.maps.event.trigger(l._map,"resize")},1e3)},0),o.$on("pipLayoutResized",function(){null!=l._map&&google.maps.event.trigger(l._map,"resize")})}return o.$inject=["$scope","$rootScope","$timeout","$mdDialog","locationPos","locationName"],o.prototype.createMarker=function(o){var n=this;if(this._marker&&this._marker.setMap(null),o){this._marker=new google.maps.Marker({position:o,map:this._map,draggable:!0,animation:google.maps.Animation.DROP});var i=this._marker;google.maps.event.addListener(i,"dragend",function(){var o=i.getPosition();n.changeLocation(o,null)})}else this._marker=null;return this._marker},o.prototype.changeLocation=function(o,n){var i=this;if(this.locationPos={type:"Point",coordinates:[o.lat(),o.lng()]},this.locationName=null,null!=n||null!=n){var t=new google.maps.Geocoder;t.geocode({location:o},function(o,n){n==google.maps.GeocoderStatus.OK&&o&&o.length>0&&(i.locationName=o[0].formatted_address),i._$scope.$apply()})}},o.prototype.onAddPin=function(){if(null!=this._map){var o=this._map.getCenter();this._marker=this.createMarker(o),this.changeLocation(o,null)}},o.prototype.onRemovePin=function(){null!=this._map&&(this._marker=this.createMarker(null),this.locationPos=null,this.locationName=null)},o.prototype.onZoomIn=function(){if(null!=this._map){var o=this._map.getZoom();this._map.setZoom(o+1)}},o.prototype.onZoomOut=function(){if(null!=this._map){var o=this._map.getZoom();this._map.setZoom(o>1?o-1:o)}},o.prototype.onCancel=function(){this._$mdDialog.cancel()},o.prototype.onApply=function(){this._$mdDialog.hide({location:this.locationPos,locationPos:this.locationPos,locationName:this.locationName})},o}();!function(){"use strict";function o(o){var n=o.has("pipTranslate")?o.get("pipTranslate"):null;n&&(n.setTranslations("en",{LOCATION_ADD_LOCATION:"Add location",LOCATION_SET_LOCATION:"Set location",LOCATION_ADD_PIN:"Add pin",LOCATION_REMOVE_PIN:"Remove pin"}),n.setTranslations("ru",{LOCATION_ADD_LOCATION:"Добавить местоположение",LOCATION_SET_LOCATION:"Определить положение",LOCATION_ADD_PIN:"Добавить точку",LOCATION_REMOVE_PIN:"Убрать точку"}))}o.$inject=["$injector"],angular.module("pipLocationEditDialog",["ngMaterial","pipLocations.Templates"]).run(o).service("pipLocationEditDialog",t).controller("pipLocationEditDialogController",e)}()},{}],4:[function(o,n,i){!function(){"use strict";var o=angular.module("pipLocationEdit",["pipLocationEditDialog"]);o.directive("pipLocationEdit",["$parse","$http","pipLocationEditDialog",function(o,n,i){return{restrict:"EAC",scope:{pipLocationName:"=",pipLocationPos:"=",pipLocationHolder:"=",ngDisabled:"&",pipChanged:"&"},template:String()+'<md-input-container class="md-block"><label>{{ \'LOCATION\' | translate }}</label><input ng-model="pipLocationName"ng-disabled="ngDisabled()"/></md-input-container><div class="pip-location-empty" layout="column" layout-align="center center"><md-button class="md-raised" ng-disabled="ngDisabled()" ng-click="onSetLocation()"aria-label="LOCATION_ADD_LOCATION"><span class="icon-location"></span> {{::\'LOCATION_ADD_LOCATION\' | translate }}</md-button></div><div class="pip-location-container" tabindex="{{ ngDisabled() ? -1 : 0 }}" ng-click="onMapClick($event)" ng-keypress=""onMapKeyPress($event)"></div>',controller:["$scope","$element",function(o,n){n.find("md-input-container").attr("md-no-float",!!o.pipLocationHolder)}],link:function(o,n){function t(){p&&p.remove(),p=null,c.hide(),l.show()}function e(){var n=o.pipLocationPos;if(null==n||null==n.coordinates||n.coordinates.length<0)return void t();var i=new google.maps.LatLng(n.coordinates[0],n.coordinates[1]);p&&p.remove(),c.show(),l.hide(),p=$("<div></div>"),p.appendTo(c);var e={center:i,zoom:12,mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:!0,disableDoubleClickZoom:!0,scrollwheel:!1,draggable:!1},a=new google.maps.Map(p[0],e);new google.maps.Marker({position:i,map:a})}function a(){var n=o.pipLocationName;if(""==n)return o.pipLocationPos=null,t(),void o.$apply();var i=new google.maps.Geocoder;i.geocode({address:n},function(n,i){o.$apply(function(){if(i==google.maps.GeocoderStatus.OK){if(null==n||0==n.length)return o.pipLocationPos=null,void t();var e=n[0].geometry||{},a=e.location||{};if(null==a.lat||null==a.lng)return o.pipLocationPos=null,void t();o.pipLocationPos={type:"Point",coordinates:[a.lat(),a.lng()]}}else o.pipLocationPos=null})})}var l=n.children(".pip-location-empty"),c=n.children(".pip-location-container"),p=null,r=_.debounce(a,2e3);o.onSetLocation=function(){o.ngDisabled()||i.show({locationName:o.pipLocationName,locationPos:o.pipLocationPos},function(n){var i=n.location,t=n.locationName;o.pipLocationPos&&"Point"==o.pipLocationPos.type&&2==o.pipLocationPos.coordinates.length&&i&&2==i.coordinates.length&&o.pipLocationPos.coordinates[0]-i.coordinates[0]<1e-4&&o.pipLocationPos.coordinates[1]-i.coordinates[1]<1e-4&&t==o.pipLocationName||(o.pipLocationPos=i,o.pipLocationName=t,null==t&&null!=i&&(o.pipLocationName="("+n.location.coordinates[0]+","+n.location.coordinates[1]+")"),o.pipChanged(),c[0].focus())})},o.onMapClick=function(n){o.ngDisabled()||(c[0].focus(),o.onSetLocation())},o.onMapKeyPress=function(n){o.ngDisabled()||13!=n.keyCode&&32!=n.keyCode||o.onSetLocation()},o.$watch(function(){return o.pipLocationName},function(o,n){o!=n&&r()}),o.$watch(function(){return o.pipLocationPos},function(){e()}),n.addClass("pip-location-edit"),o.pipLocationPos?e():t()}}}])}()},{}],5:[function(o,n,i){!function(){"use strict";var o=angular.module("pipLocationIp",[]);o.directive("pipLocationIp",function(){return{restrict:"EA",scope:{pipIpaddress:"&",pipExtraInfo:"&"},template:'<div class="pip-location-container"></div>',controller:"pipLocationIpController"}}),o.controller("pipLocationIpController",["$scope","$element","$attrs","$http",function(o,n,i,t){function e(){r&&r.remove(),r=null}function a(o,n){if(null==o||null==n)return void e();var i=new google.maps.LatLng(o,n);r&&r.remove(),r=$("<div></div>"),r.appendTo(p);var t={center:i,zoom:12,mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:!0,disableDoubleClickZoom:!0,scrollwheel:!1,draggable:!1},a=new google.maps.Map(r[0],t);new google.maps.Marker({position:i,map:a})}function l(o){return null!=o&&(!!o&&(o=o.toString().toLowerCase(),"1"==o||"true"==o))}function c(){var n=o.pipIpaddress();return""==n?void e():void t.jsonp("https://www.geoplugin.net/json.gp?ip="+n+"&jsoncallback=JSON_CALLBACK").success(function(n){if(null!=n&&null!=n.geoplugin_latitude&&null!=n.geoplugin_longitude){if(a(n.geoplugin_latitude,n.geoplugin_longitude),o.pipExtraInfo){var i={city:n.geoplugin_city,regionCode:n.geoplugin_regionCode,region:n.geoplugin_regionName,areaCode:n.geoplugin_areaCode,countryCode:n.geoplugin_countryCode,country:n.geoplugin_countryName,continentCode:n.geoplugin_continentCode};o.pipExtraInfo({extraInfo:i})}}else e()}).error(function(o){console.error(o),e()})}var p=n.children(".pip-location-container"),r=null;l(i.pipRebind)&&o.$watch(function(){return o.pipIpaddress()},function(o){c()}),n.addClass("pip-location-ip"),c()}])}()},{}],6:[function(o,n,i){!function(){"use strict";var o=angular.module("pipLocationMap",[]);o.directive("pipLocationMap",function(){return{restrict:"EA",scope:{pipLocationPos:"&",pipLocationPositions:"&",pipIconPath:"&",pipDraggable:"&",pipStretch:"&"},template:'<div class="pip-location-container"></div>',controller:"pipLocationMapController"}}),o.controller("pipLocationMapController",["$scope","$element","$attrs","$parse","$timeout",function(o,n,i,t,e){function a(){d&&d.remove(),d=null}function l(o){return!(null==o||null==o.coordinates||o.coordinates.length<0)}function c(o){var n=new google.maps.LatLng(o.coordinates[0],o.coordinates[1]);return n.fill=o.fill,n.stroke=o.stroke,n}function p(o){return null!=o&&(!!o&&(o=o.toString().toLowerCase(),"1"==o||"true"==o))}function r(){var n=o.pipLocationPos(),i=o.pipLocationPositions(),t=[],e=o.pipDraggable()||!1;if(l(n)?t.push(c(n)):i&&i.length&&i.length>0&&i.forEach(function(o){l(o)&&t.push(c(o))}),0===t.length)return void a();d&&d.remove(),d=$("<div></div>"),d.appendTo(s);var p={center:t[0],zoom:12,mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:!0,disableDoubleClickZoom:!0,scrollwheel:e,draggable:e},r=new google.maps.Map(d[0],p),u=new google.maps.LatLngBounds;t.forEach(function(o){var n={path:g,fillColor:o.fill||"#EF5350",fillOpacity:1,scale:1,strokeColor:o.stroke||"white",strokeWeight:5};new google.maps.Marker({position:o,map:r,icon:g?n:null}),u.extend(o)}),t.length>1&&r.fitBounds(u)}var s=n.children(".pip-location-container"),d=null,u=o.pipStretch()||!1,g=o.pipIconPath();p(i.pipRebind)&&o.$watch(function(){return o.pipLocationPos()},function(){r()}),n.addClass("pip-location-map"),u&&s.addClass("stretch"),o.pipLocationPos()||o.pipLocationPositions()?e(r,200):a()}])}()},{}],7:[function(o,n,i){!function(){"use strict";angular.module("pipLocations",["pipLocation","pipLocationMap","pipLocationIp","pipLocationEditDialog","pipLocationEdit","pipLocations.Translate"])}()},{}],8:[function(o,n,i){!function(o){try{o=angular.module("pipLocations.Templates")}catch(n){o=angular.module("pipLocations.Templates",[])}o.run(["$templateCache",function(o){o.put("location_dialog/location_dialog.html",'<md-dialog class="pip-dialog pip-location-edit-dialog layout-column" md-theme="{{$ctrl.theme}}"><div class="pip-header layout-column layout-align-start-start"><md-progress-linear ng-show="$ctrl.transaction.busy()" md-mode="indeterminate" class="pip-progress-top"></md-progress-linear><h3 class="flex">{{ \'LOCATION_SET_LOCATION\' | translate }}</h3></div><div class="pip-footer"><div class="layout-row layout-align-start-center"><md-button class="md-accent" ng-click="$ctrl.onAddPin()" ng-show="$ctrl.locationPos == null" ng-disabled="$ctrl.transaction.busy()" aria-label="{{ ::\'LOCATION_ADD_PIN\' }}">{{ ::\'LOCATION_ADD_PIN\' | translate }}</md-button><md-button class="md-accent" ng-click="$ctrl.onRemovePin()" ng-show="$ctrl.locationPos != null" ng-disabled="$ctrl.transaction.busy()" aria-label="{{ ::\'LOCATION_REMOVE_PIN\' }}">{{ ::\'LOCATION_REMOVE_PIN\' | translate }}</md-button></div><div class="flex"></div><div class="layout-row layout-align-end-center"><md-button ng-click="$ctrl.onCancel()" aria-label="{{ ::\'CANCEL\' }}">{{ ::\'CANCEL\' | translate }}</md-button><md-button class="md-accent" ng-click="$ctrl.onApply()" ng-disabled="$ctrl.transaction.busy()" aria-label="{{ ::\'APPLY\' }}">{{ ::\'APPLY\' | translate }}</md-button></div></div><div class="pip-body"><div class="pip-location-container"></div><md-button class="md-icon-button md-fab pip-zoom-in" ng-click="$ctrl.onZoomIn()" aria-label="{{ ::\'LOCATION_ZOOM_IN\' }}"><md-icon md-svg-icon="icons:plus"></md-icon></md-button><md-button class="md-icon-button md-fab pip-zoom-out" ng-click="$ctrl.onZoomOut()" aria-label="{{ ::\'LOCATION_ZOOM_OUT\' }}"><md-icon md-svg-icon="icons:minus"></md-icon></md-button><md-button class="md-icon-button md-fab pip-set-location" ng-click="$ctrl.onSetLocation()" aria-label="{{ ::\'LOCATION_SET_LOCATION\' }}" ng-show="supportSet" ng-disabled="transaction.busy()"><md-icon md-svg-icon="icons:target"></md-icon></md-button></div></md-dialog>')}])}()},{}]},{},[8,1,3,4,5,6,2,7])(8)});
//# sourceMappingURL=pip-webui-locations.min.js.map
